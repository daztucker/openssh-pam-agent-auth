VPATH=@top_srcdir@

CC=@CC@
LD=@LD@
CFLAGS=@CFLAGS@
CFLAGS_NOPIE=@CFLAGS_NOPIE@
CPPFLAGS=-I. -I../.. -I$(srcdir) @CPPFLAGS@ $(PATHS) @DEFS@
PICFLAG=@PICFLAG@
LIBS=@LIBS@
K5LIBS=@K5LIBS@
GSSLIBS=@GSSLIBS@
SSHDLIBS=@SSHDLIBS@
LIBEDIT=@LIBEDIT@
LIBFIDO2=@LIBFIDO2@
LDFLAGS=-L../../openbsd-compat/ @LDFLAGS@
LDFLAGS_NOPIE=-L../../openbsd-compat/ @LDFLAGS_NOPIE@

PAM_SSH_AGENT_AUTH_SRCS=\
	pam-ssh-agent-auth.c auth-options.c ssh-sk-client.c \
	ssh-xmss.c \
	sshkey-xmss.c \
	xmss_commons.c \
	xmss_fast.c \
	xmss_hash.c \
	xmss_hash_address.c \
	xmss_wots.c \
	ssh_api.c \
	ssherr.c \
	sshbuf.c \
	sshkey.c \
	sshbuf-getput-basic.c \
	sshbuf-misc.c \
	sshbuf-getput-crypto.c \
	krl.c \
	bitmap.c \
	authfd.c authfile.c \
	canohost.c channels.c cipher.c cipher-aes.c cipher-aesctr.c \
	cipher-ctr.c cleanup.c \
	compat.c fatal.c hostfile.c \
	log.c match.c moduli.c nchan.c packet.c \
	readpass.c xmalloc.c addr.c addrmatch.c \
	atomicio.c dispatch.c mac.c misc.c utf8.c \
	monitor_fdpass.c rijndael.c ssh-dss.c ssh-ecdsa.c ssh-ecdsa-sk.c \
	ssh-ed25519-sk.c ssh-rsa.c dh.c \
	msg.c progressmeter.c dns.c entropy.c gss-genr.c umac.c umac128.c \
	ssh-pkcs11.c smult_curve25519_ref.c \
	poly1305.c chacha.c cipher-chachapoly.c cipher-chachapoly-libcrypto.c \
	ssh-ed25519.c digest-openssl.c digest-libc.c \
	hmac.c sc25519.c ge25519.c fe25519.c ed25519.c verify.c hash.c \
	kex.c kexdh.c kexgex.c kexecdh.c kexc25519.c \
	kexgexc.c kexgexs.c \
	kexsntrup761x25519.c sntrup761.c kexgen.c \
	sftp-realpath.c platform-pledge.c platform-tracing.c platform-misc.c \
	sshbuf-io.c

pam_ssh_agent_auth.so: $(PAM_SSH_AGENT_AUTH_SRCS)
	$(CC) $(CFLAGS) $(CPPFLAGS) $(PICFLAG) -shared -o $@ $< \
	    -lopenbsd-compat $(LDFLAGS_NOPIE) $(LIBS) -lpam

clean:
	rm -f pam_ssh_agent_auth.so
